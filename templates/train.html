<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWSkills Mini-Hackathon: Train Model</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.11/typed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* Import Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Ubuntu:wght@400;500;700&display=swap');
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            text-decoration: none;
        }
        html {
            scroll-behavior: smooth;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* General Styling */
        body {
            font-family: 'Poppins', sans-serif;
        }
        section {
            padding: 10px 0;
        }
        .max-width {
            max-width: 1300px;
            padding: 0 80px;
            margin: auto;
        }
        .intro, .training, footer {
            font-family: 'Poppins', sans-serif;
        }
        .intro .intro-content, .training .training-content {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }
        section .title {
            position: relative;
            text-align: center;
            font-size: 40px;
            font-weight: 500;
            margin-bottom: 40px;
            padding-bottom: 20px;
            font-family: 'Ubuntu', sans-serif;
        }
        section .title::before {
            content: "";
            position: absolute;
            bottom: 0px;
            left: 50%;
            width: 180px;
            height: 3px;
            background: #111;
            transform: translateX(-50%);
        }
        section .subtitle {
            font-size: 25px;
            font-weight: 600;
            margin-bottom: 20px;
            font-family: 'Ubuntu', sans-serif;
            text-align: center;
            color: #111;
        }
        /* Navbar Styling */
        .navbar {
            position: fixed;
            width: 100%;
            z-index: 999;
            padding: 30px 0;
            background: #fff; /* Changed to white for initial visibility */
            font-family: 'Ubuntu', sans-serif;
            transition: all 0.3s ease;
        }
        .navbar.sticky {
            padding: 15px 0;
            background: #ff0000;
        }
        .navbar .max-width {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .navbar .logo a {
            color: #000; /* Changed to black for visibility on white background */
            font-size: 35px;
            font-weight: 600;
        }
        .navbar .logo a span {
            color: #0863cb;
            transition: all 0.3s ease;
        }
        .navbar.sticky .logo a {
            color: #fff; /* White text on sticky red background */
        }
        .navbar.sticky .logo a span {
            color: #fff;
        }
        .navbar .menu li {
            list-style: none;
            display: inline-block;
        }
        .navbar .menu li a {
            display: block;
            color: #000; /* Changed to black for visibility on white background */
            font-size: 18px;
            font-weight: 500;
            margin-left: 25px;
            transition: color 0.3s ease;
        }
        .navbar .menu li a:hover {
            color: #ff0000;
        }
        .navbar.sticky .menu li a {
            color: #fff; /* White text on sticky red background */
        }
        .navbar.sticky .menu li a:hover {
            color: #fff;
        }
        .navbar .menu li a.special {
            background: #ff0000;
            padding: 8px 16px;
            border-radius: 6px;
            border: 2px solid #ff0000;
            color: #fff;
            transition: all 0.3s ease;
        }
        .navbar .menu li a.special:hover {
            background: none;
            color: #ff0000;
        }
        .menu-btn {
            color: #000; /* Changed to black for visibility on white background */
            font-size: 23px;
            cursor: pointer;
            display: none;
        }
        .navbar.sticky .menu-btn {
            color: #fff; /* White text on sticky red background */
        }
        /* Scroll-Up Button */
        .scroll-up-btn {
            position: fixed;
            height: 45px;
            width: 42px;
            background: #ff0000;
            right: 30px;
            bottom: 10px;
            text-align: center;
            line-height: 45px;
            color: #fff;
            z-index: 9999;
            font-size: 30px;
            border-radius: 6px;
            cursor: pointer;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        .scroll-up-btn.show {
            bottom: 30px;
            opacity: 1;
            pointer-events: auto;
        }
        .scroll-up-btn:hover {
            filter: brightness(90%);
        }
        /* Intro Section (to move title down) */
        .intro {
            display: flex;
            background: #f9f9f9;
            min-height: 200px;
            color: #fff;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 50px 0;
        }
        .intro .intro-content .text-1 {
            font-size: 30px;
            font-weight: 600;
            color: #111;
            margin-bottom: 5px;
            font-family: 'Ubuntu', sans-serif;
        }
        /* Training Section */
        .training .training-content p {
            text-align: justify;
            font-size: 16px;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.8;
        }
        .training .training-content .btn-primary {
            display: inline-block;
            background: #ff0000;
            color: #fff;
            font-size: 20px;
            padding: 10px 30px;
            margin-top: 25px;
            font-weight: 500;
            border-radius: 6px;
            border: 2px solid #ff0000;
            transition: all 0.3s ease;
        }
        .training .training-content .btn-primary:hover {
            color: #ff0000;
            background: none;
        }
        .training .training-content .log-box {
            border: 1px solid #da0b0b;
            padding: 12px;
            max-height: 450px;
            overflow-y: auto;
            font-family: 'Courier New', Courier, monospace;
            background: #cceaed;
            border-radius: 6px;
            margin-top: 20px;
        }
        .training .training-content .log-box p {
            margin: 5px 0;
        }
        .training .training-content .log-box .error-log {
            color: #ff0000;
        }
        .training .training-content .log-box .text-green-600 {
            color: #28a745; /* Matches Tailwind's green-600 for JavaScript compatibility */
        }
        /* Footer */
        footer {
            background: #111;
            padding: 20px 23px;
            color: #fff;
            text-align: center;
        }
        .intro {
            padding: 0 !important;
            margin: 0 !important;
            min-height: 0 !important;
        }

        .footer-container {
            background: #111;
            padding: 25px;
        }
        .socialmediaicon {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .socialmediaicon a {
            padding: 10px;
            background: #fff;
            margin: 10px;
            border-radius: 50%;
        }
        .socialmediaicon a i {
            font-size: 2em;
            color: #000;
            opacity: 0.9;
        }
        .socialmediaicon a:hover {
            background: #111;
            transition: 0.5s;
        }
        .socialmediaicon a:hover i {
            color: #fff;
            transition: 0.5s;
        }
        .footerbottom p {
            color: #fff;
        }
        .footerbottom span {
            color: #ff0000;
        }
        /* Responsive Design */
        @media (max-width: 947px) {
            .menu-btn {
                display: block;
                z-index: 999;
            }
            .menu-btn i.active:before {
                content: "\f00d";
            }
            .navbar .menu {
                position: fixed;
                height: 100vh;
                width: 100%;
                left: -100%;
                top: 0;
                background: #111;
                text-align: center;
                padding-top: 80px;
                transition: all 0.3s ease;
            }
            .navbar .menu.active {
                left: 0;
            }
            .navbar .menu li {
                display: block;
            }
            .navbar .menu li a {
                display: inline-block;
                margin: 20px 0;
                font-size: 25px;
            }
            .max-width {
                padding: 0 50px;
            }
            .intro .intro-content .text-1 {
                font-size: 25px;
            }
        }
        @media (max-width: 690px) {
            .max-width {
                padding: 0 23px;
            }
            .intro .intro-content .text-1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="scroll-up-btn">
        <i class="fas fa-angle-up"></i>
    </div>
    <nav class="navbar">
        <div class="max-width">
            <div class="logo"><a href="/home">PW<span>Skills</span></a></div>
            <ul class="menu">
                <li><a href="/home" class="menu-btn">Home</a></li>
                <li><a href="#problem-statement" class="menu-btn">Problem Statement</a></li>
                <li><a href="#dataset" class="menu-btn">Dataset</a></li>
                <li><a href="#tech-stack" class="menu-btn">Tech Stack</a></li>
                <li><a href="/eda" class="menu-btn special">EDA Dashboard</a></li>
                <li><a href="/train" class="menu-btn special">Train Model</a></li>
                <li><a href="/predict" class="menu-btn special">Predict</a></li>
            </ul>
            <div class="menu-btn">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>
    <!-- Intro Section (to move title down) -->
     <br><br>
<section class="intro" id="intro">
    <div class="max-width">
        <div class="intro-content">
            <div class="text-1">Welcome to Model Training</div>
            <img src="https://res.cloudinary.com/dqcvlj2il/image/upload/v1758097555/djI-OqZGTt2Btw4yjolcJw_vp7a2z.jpg" 
                 alt="Model Training Image" 
                 style="margin-top: 15px; max-width: 100%; height: auto; border-radius: 8px;">
        </div>
    </div>
</section>

    <!-- Main Content: Training Section -->
    <section class="training" id="training">
        <div class="max-width">
            <h2 class="title">Train the Session Revenue Model</h2>
            <div class="training-content">
                <p class="text-justify">
                    Use this page to train the machine learning model for predicting whether an online shopping session will generate revenue. Click the button below to start the training process, and monitor the progress in the log output box.
                </p>
                <div class="mb-6">
                    <button id="trainBtn" class="btn-primary">Train Model</button>
                </div>
                <h2 class="subtitle">Training Log</h2>
                <div id="logBox" class="log-box">
                    <p>Ready to start training...</p>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="socialmediaicon">
                <a href="https://www.facebook.com/pwskills" target="_blank" title="Facebook" rel="noopener noreferrer"><i class="fab fa-facebook-f"></i></a>
                <a href="https://x.com/pwskills" target="_blank" title="Twitter" rel="noopener noreferrer"><i class="fab fa-twitter"></i></a>
                <a href="https://pwskills.com/" target="_blank" title="PWSkills Website" rel="noopener noreferrer"><i class="fas fa-globe"></i></a>
                <a href="https://swachhbharatmission.ddws.gov.in/" target="_blank" title="Swachh Bharat Mission" rel="noopener noreferrer"><i class="fas fa-leaf"></i></a>
            </div>
        </div>
        <div class="footerbottom">
            <p>&copy; 2025 PWSkills. All rights reserved. | Designed by <span class="design">PWSkills</span></p>
        </div>
    </footer>
    <script>
        $(document).ready(function(){
            $(window).scroll(function(){
                // Sticky navbar
                if(this.scrollY > 20){
                    $('.navbar').addClass("sticky");
                } else {
                    $('.navbar').removeClass("sticky");
                }
                // Scroll-up button show/hide
                if(this.scrollY > 500){
                    $('.scroll-up-btn').addClass("show");
                } else {
                    $('.scroll-up-btn').removeClass("show");
                }
            });
            // Slide-up
            $('.scroll-up-btn').click(function(){
                $('html').animate({scrollTop: 0});
                $('html').css("scrollBehavior", "auto");
            });
            $('.navbar .menu li a').click(function(){
                $('html').css("scrollBehavior", "smooth");
            });
            // Toggle menu/navbar
            $('.menu-btn').click(function(){
                $('.navbar .menu').toggleClass("active");
                $('.menu-btn i').toggleClass("active");
            });
        });
        const trainBtn = document.getElementById('trainBtn');
        const logBox = document.getElementById('logBox');
        
        function setBusy(btn, busy, textBusy = 'Working...') {
            btn.disabled = !!busy;
            if (busy) {
                btn.dataset.label = btn.textContent;
                btn.textContent = textBusy;
            } else {
                btn.textContent = btn.dataset.label || btn.textContent;
            }
        }
        
        async function fetchLogs() {
            try {
                const response = await fetch('/logs');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                if (data.status === 'success') {
                    logBox.innerHTML = '';
                    data.logs.forEach(log => {
                        const p = document.createElement('p');
                        p.textContent = log;
                        if (log.includes('ERROR')) {
                            p.classList.add('error-log');
                        }
                        logBox.appendChild(p);
                    });
                    logBox.scrollTop = logBox.scrollHeight;
                } else {
                    const p = document.createElement('p');
                    p.classList.add('error-log');
                    p.textContent = 'Error: ' + data.message;
                    logBox.appendChild(p);
                    logBox.scrollTop = logBox.scrollHeight;
                }
            } catch (error) {
                const p = document.createElement('p');
                p.classList.add('error-log');
                p.textContent = 'Error fetching logs: ' + error.message;
                logBox.appendChild(p);
                logBox.scrollTop = logBox.scrollHeight;
            }
        }
        
        trainBtn.addEventListener('click', async () => {
            setBusy(trainBtn, true, 'Training...');
            logBox.innerHTML = '<p class="text-green-600">Initializing training...</p>';
            
            // Start polling logs
            const logInterval = setInterval(fetchLogs, 1000);
            
            // Trigger training
            try {
                const res = await fetch('/train', { method: 'POST' });
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                const data = await res.json();
                clearInterval(logInterval);
                if (data.status !== 'success') {
                    throw new Error(data.message || 'Training failed');
                }
                logBox.innerHTML += '<p class="text-green-600">Training completed successfully!</p>';
                logBox.scrollTop = logBox.scrollHeight;
                fetchLogs(); // Final log fetch
            } catch (e) {
                clearInterval(logInterval);
                const p = document.createElement('p');
                p.classList.add('error-log');
                p.textContent = 'Error: ' + (e.message || 'Training failed');
                logBox.appendChild(p);
                logBox.scrollTop = logBox.scrollHeight;
            } finally {
                setBusy(trainBtn, false);
            }
        });
        
        // Initial log fetch
        fetchLogs();
    </script>
</body>
</html>